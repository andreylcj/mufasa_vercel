{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\gusta\\\\Pessoal\\\\Mufasa\\\\mufasa_vercel\\\\store\\\\GlobalState.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport React, { createContext, useEffect, useReducer } from 'react';\nimport reducers from './Reducers';\nimport { ACTION } from './Actions';\nimport { getData } from '../assets/utils/fetchData';\nimport initialState from './InitialState';\nexport var DataContext = /*#__PURE__*/createContext();\nexport var DataProvider = function DataProvider(_ref) {\n  _s();\n\n  var children = _ref.children;\n\n  var _useReducer = useReducer(reducers, initialState),\n      state = _useReducer[0],\n      dispatch = _useReducer[1];\n\n  var auth = state.auth; // AUTH\n\n  useEffect( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var firstLogin, res;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            firstLogin = localStorage.getItem('firstLogin');\n\n            if (!firstLogin) {\n              _context.next = 6;\n              break;\n            }\n\n            _context.next = 4;\n            return getData('api/auth/accessToken');\n\n          case 4:\n            res = _context.sent;\n            dispatch({\n              type: ACTION.AUTH,\n              payload: {\n                token: res.accessToken,\n                user: res.user\n              }\n            });\n\n          case 6:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  })), []); // USERS\n\n  useEffect( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            if (auth.token) {\n              if (auth.user.role === 'admin' || auth.user.role === 'master admin') {\n                getData('api/user', auth.token).then(function (res) {\n                  if (res.err) return dispatch({\n                    type: 'NOTIFY',\n                    payload: {\n                      error: res.err\n                    }\n                  });\n                  dispatch({\n                    type: 'ADD_USERS',\n                    payload: res.users\n                  });\n                });\n              }\n            } else {\n              dispatch({\n                type: 'ADD_USERS',\n                payload: []\n              });\n            }\n\n          case 1:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  })), [auth.token]);\n  return /*#__PURE__*/_jsxDEV(DataContext.Provider, {\n    value: [state, dispatch],\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 46,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(DataProvider, \"GUSXxL/WUElrtHc/X73NyHNRMdw=\");\n\n_c = DataProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"DataProvider\");","map":{"version":3,"sources":["C:/Users/gusta/Pessoal/Mufasa/mufasa_vercel/store/GlobalState.js"],"names":["React","createContext","useEffect","useReducer","reducers","ACTION","getData","initialState","DataContext","DataProvider","children","state","dispatch","auth","firstLogin","localStorage","getItem","res","type","AUTH","payload","token","accessToken","user","role","then","err","error","users"],"mappings":";;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,aAAhB,EAA+BC,SAA/B,EAA0CC,UAA1C,QAA4D,OAA5D;AACA,OAAOC,QAAP,MAAqB,YAArB;AACA,SAASC,MAAT,QAAuB,WAAvB;AACA,SAASC,OAAT,QAAwB,2BAAxB;AACA,OAAOC,YAAP,MAAyB,gBAAzB;AAEA,OAAO,IAAMC,WAAW,gBAAGP,aAAa,EAAjC;AAEP,OAAO,IAAMQ,YAAY,GAAG,SAAfA,YAAe,OAAkB;AAAA;;AAAA,MAAfC,QAAe,QAAfA,QAAe;;AAAA,oBAClBP,UAAU,CAACC,QAAD,EAAWG,YAAX,CADQ;AAAA,MACrCI,KADqC;AAAA,MAC9BC,QAD8B;;AAAA,MAGpCC,IAHoC,GAG3BF,KAH2B,CAGpCE,IAHoC,EAK5C;;AACAX,EAAAA,SAAS,wEAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AACFY,YAAAA,UADE,GACWC,YAAY,CAACC,OAAb,CAAqB,YAArB,CADX;;AAAA,iBAEJF,UAFI;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAGYR,OAAO,CAAC,sBAAD,CAHnB;;AAAA;AAGAW,YAAAA,GAHA;AAKNL,YAAAA,QAAQ,CAAC;AACPM,cAAAA,IAAI,EAAEb,MAAM,CAACc,IADN;AAEPC,cAAAA,OAAO,EAAE;AACPC,gBAAAA,KAAK,EAAEJ,GAAG,CAACK,WADJ;AAEPC,gBAAAA,IAAI,EAAEN,GAAG,CAACM;AAFH;AAFF,aAAD,CAAR;;AALM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAD,IAaN,EAbM,CAAT,CAN4C,CAqB5C;;AACArB,EAAAA,SAAS,wEAAC;AAAA;AAAA;AAAA;AAAA;AACR,gBAAIW,IAAI,CAACQ,KAAT,EAAgB;AACd,kBAAIR,IAAI,CAACU,IAAL,CAAUC,IAAV,KAAmB,OAAnB,IAA8BX,IAAI,CAACU,IAAL,CAAUC,IAAV,KAAmB,cAArD,EAAqE;AACnElB,gBAAAA,OAAO,CAAC,UAAD,EAAaO,IAAI,CAACQ,KAAlB,CAAP,CACGI,IADH,CACQ,UAACR,GAAD,EAAS;AACb,sBAAIA,GAAG,CAACS,GAAR,EAAa,OAAOd,QAAQ,CAAC;AAAEM,oBAAAA,IAAI,EAAE,QAAR;AAAkBE,oBAAAA,OAAO,EAAE;AAAEO,sBAAAA,KAAK,EAAEV,GAAG,CAACS;AAAb;AAA3B,mBAAD,CAAf;AACbd,kBAAAA,QAAQ,CAAC;AAAEM,oBAAAA,IAAI,EAAE,WAAR;AAAqBE,oBAAAA,OAAO,EAAEH,GAAG,CAACW;AAAlC,mBAAD,CAAR;AACD,iBAJH;AAKD;AACF,aARD,MAQO;AACLhB,cAAAA,QAAQ,CAAC;AAAEM,gBAAAA,IAAI,EAAE,WAAR;AAAqBE,gBAAAA,OAAO,EAAE;AAA9B,eAAD,CAAR;AACD;;AAXO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAD,IAYN,CAACP,IAAI,CAACQ,KAAN,CAZM,CAAT;AAcA,sBACE,QAAC,WAAD,CAAa,QAAb;AAAsB,IAAA,KAAK,EAAE,CAACV,KAAD,EAAQC,QAAR,CAA7B;AAAA,cACGF;AADH;AAAA;AAAA;AAAA;AAAA,WADF;AAMD,CA1CM;;GAAMD,Y;;KAAAA,Y","sourcesContent":["import React, { createContext, useEffect, useReducer } from 'react';\r\nimport reducers from './Reducers';\r\nimport { ACTION } from './Actions';\r\nimport { getData } from '../assets/utils/fetchData';\r\nimport initialState from './InitialState';\r\n\r\nexport const DataContext = createContext();\r\n\r\nexport const DataProvider = ({ children }) => {\r\n  const [state, dispatch] = useReducer(reducers, initialState);\r\n\r\n  const { auth } = state;\r\n\r\n  // AUTH\r\n  useEffect(async () => {\r\n    const firstLogin = localStorage.getItem('firstLogin');\r\n    if (firstLogin) {\r\n      const res = await getData('api/auth/accessToken');\r\n\r\n      dispatch({\r\n        type: ACTION.AUTH,\r\n        payload: {\r\n          token: res.accessToken,\r\n          user: res.user,\r\n        },\r\n      });\r\n    }\r\n  }, []);\r\n\r\n  // USERS\r\n  useEffect(async () => {\r\n    if (auth.token) {\r\n      if (auth.user.role === 'admin' || auth.user.role === 'master admin') {\r\n        getData('api/user', auth.token)\r\n          .then((res) => {\r\n            if (res.err) return dispatch({ type: 'NOTIFY', payload: { error: res.err } });\r\n            dispatch({ type: 'ADD_USERS', payload: res.users });\r\n          });\r\n      }\r\n    } else {\r\n      dispatch({ type: 'ADD_USERS', payload: [] });\r\n    }\r\n  }, [auth.token]);\r\n\r\n  return (\r\n    <DataContext.Provider value={[state, dispatch]}>\r\n      {children}\r\n    </DataContext.Provider>\r\n\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}